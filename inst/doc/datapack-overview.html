<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="date" content="2017-08-02" />

<title>datapack R package overview</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">datapack R package overview</h1>
<h4 class="date"><em>2017-08-02</em></h4>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The <em>datapack</em> R package provides an abstraction for collating multile data objects of different types and metadata describing those objects into a bundle that can be transported and loaded using a single composite file. It is primarily meant as a container to bundle together files for transport to or from DataONE data repositories.</p>
<p>The methods in this package provide a convenient way to load data from common repositories such as DataONE into the R environment, and to document, serialize, and save data from R to data repositories.</p>
</div>
<div id="create-a-single-object" class="section level2">
<h2>Create a Single Object</h2>
<p>The <em>datapack</em> DataObject class is a wrapper that contains both data and system metadata that describes the data. The data can be either R <code>raw</code> data or a data file, for example a CSV file. The system metadata includes attributes such as the object identifier, type, size, checksum, owner, version relationship to other objects, access rules, and other critical metadata.</p>
<p>The following example shows how to create a DataObject from a CSV file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(datapack)
<span class="kw">library</span>(uuid)
csvfile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/sample-data.csv&quot;</span>, <span class="dt">package=</span><span class="st">&quot;datapack&quot;</span>)
myId &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;urn:uuid:&quot;</span>, <span class="kw">UUIDgenerate</span>(), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
myObj &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;DataObject&quot;</span>, <span class="dt">id=</span>myId, <span class="dt">format=</span><span class="st">&quot;text/csv&quot;</span>, <span class="dt">filename=</span>csvfile)</code></pre></div>
<p>The DataObject <code>myObj</code> now contains the CSV data as well as the system-level information describing the file, such as its identifier, type, and checksum. The <em>getData</em> method can be used to extract the data content of a DataObject. Using the example DataObject:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rawData &lt;-<span class="st"> </span><span class="kw">getData</span>(myObj)</code></pre></div>
<p>This raw data can be converted back to CSV format using the R commands:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tf &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext=</span><span class="st">&quot;.csv&quot;</span>)
<span class="kw">write.csv</span>(<span class="kw">rawToChar</span>(rawData), tf, <span class="dt">quote=</span>F, <span class="dt">row.names=</span>F)</code></pre></div>
<p>Alternatively, the CSV data could be converted into a data frame using standard R functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">textConnection</span>(<span class="kw">rawToChar</span>(rawData)))
<span class="kw">head</span>(df)</code></pre></div>
<pre><code>##             Species_Name light temp cont moist react nutr
## 1  Achillea millefolium      8    0    0     4     0    5
## 2 Achillea tanacetifolia     0    0    0     0     0    0
## 3    Aconitum lycoctonum     3    4    4     7     7    8
## 4    Aconitum variegatum     5    4    4     7     8    7
## 5         Actaea spicata     3    5    4     5     6    7
## 6  Aegopodium podagraria     5    5    3     6     7    8</code></pre>
<p>If the data were another format than CSV, such as PNG, JPEG, or NetCDF, the corresponding R packages could be used to handle the object.</p>
<p>Each DataObject has an identifier which can be used to refer to that object, and is meant to be globally unique so that it can be used in data repositories such as those from the DataONE federation. To retrieve the identifier associated with a DataObject:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getIdentifier</span>(myObj)</code></pre></div>
<pre><code>## [1] &quot;urn:uuid:a494d57c-1f80-4982-8322-eceb6d26fc1b&quot;</code></pre>
<p>In this case, the identifier was created in the UUID format, but other identifiers such as DOIs (Digital Object Identifers) can also be used. Each object also is associated with a specific format. To retrieve the format type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getFormatId</span>(myObj)</code></pre></div>
<pre><code>## [1] &quot;text/csv&quot;</code></pre>
<p>All system metadata information for a DataObject can be accessed directly from the SystemMetadata object contained in the DataObject:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(myObj@sysmeta)</code></pre></div>
<pre><code>## Formal class 'SystemMetadata' [package &quot;datapack&quot;] with 24 slots
##   ..@ serialVersion          : num 1
##   ..@ identifier             : chr &quot;urn:uuid:a494d57c-1f80-4982-8322-eceb6d26fc1b&quot;
##   ..@ formatId               : chr &quot;text/csv&quot;
##   ..@ size                   : num 7718
##   ..@ checksum               : chr &quot;aa767c3d9fe95ea1670cf3df82922872550f3a81&quot;
##   ..@ checksumAlgorithm      : chr &quot;SHA-1&quot;
##   ..@ submitter              : chr NA
##   ..@ rightsHolder           : chr NA
##   ..@ accessPolicy           :'data.frame':  0 obs. of  2 variables:
##   .. ..$ subject   : Factor w/ 0 levels: 
##   .. ..$ permission: Factor w/ 0 levels: 
##   ..@ replicationAllowed     : logi TRUE
##   ..@ numberReplicas         : num 3
##   ..@ preferredNodes         : list()
##   ..@ blockedNodes           : list()
##   ..@ obsoletes              : chr NA
##   ..@ obsoletedBy            : chr NA
##   ..@ archived               : logi FALSE
##   ..@ dateUploaded           : chr NA
##   ..@ dateSysMetadataModified: chr &quot;2017-08-03T04:03:00Z&quot;
##   ..@ originMemberNode       : chr NA
##   ..@ authoritativeMemberNode: chr NA
##   ..@ seriesId               : chr NA
##   ..@ mediaType              : chr NA
##   ..@ fileName               : chr &quot;sample-data.csv&quot;
##   ..@ mediaTypeProperty      : list()</code></pre>
<p>The system metadata contains access policy information for the DataObject that could be used by a data repository that the object is uploaded to. For example, when a DataObject is uploaded to a <a href="https://www.dataone.org/current-member-nodes">DataONE Member Node</a>, the access policy is applied to the uploaded data and controls access to the data on the Member Node by DataONE users.</p>
<p>Before the DataObject is uploaded, access can be set so that anyone can read the uploaded data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myObj &lt;-<span class="st"> </span><span class="kw">setPublicAccess</span>(myObj)
myObj@sysmeta@accessPolicy</code></pre></div>
<pre><code>##   subject permission
## 1  public       read</code></pre>
<p>Individual access rules can also be added one at a time. The access rules are expressed using the unique identifier for an individual, such as their ORCID identity, or whatever form the repository supports.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myObj &lt;-<span class="st"> </span><span class="kw">addAccessRule</span>(myObj, <span class="st">&quot;http://orcid.org/0000-0003-0077-4738&quot;</span>, <span class="st">&quot;write&quot;</span>)
myObj@sysmeta@accessPolicy</code></pre></div>
<pre><code>##                                subject permission
## 1                               public       read
## 2 http://orcid.org/0000-0003-0077-4738      write</code></pre>
<p>The permissions that can be set include:</p>
<ul>
<li>read: permission to read the data from the repository</li>
<li>write: permission to perform update operations on the data</li>
<li>changePermission: permission to control access to the data on the repository</li>
</ul>
<p>Alternatively, multiple access rules can be added:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">accessRules &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">subject=</span><span class="kw">c</span>(<span class="st">&quot;uid=jsmith,o=Account,dc=example,dc=com&quot;</span>,  
                                    <span class="st">&quot;uid=jadams,o=Account,dc=example,dc=org&quot;</span>), 
                          <span class="dt">permission=</span><span class="kw">c</span>(<span class="st">&quot;write&quot;</span>, <span class="st">&quot;changePermission&quot;</span>))
myObj &lt;-<span class="st"> </span><span class="kw">addAccessRule</span>(myObj, accessRules)
myObj@sysmeta@accessPolicy</code></pre></div>
<pre><code>##                                  subject       permission
## 1                                 public             read
## 2   http://orcid.org/0000-0003-0077-4738            write
## 3 uid=jsmith,o=Account,dc=example,dc=com            write
## 4 uid=jadams,o=Account,dc=example,dc=org changePermission</code></pre>
<p>The <em>dataone</em> R package can be used to upload or download DataObjects to a DataONE Member Node. Please see the web page for the <a href="http://github.com/DataONEorg/rdataone"><em>dataone</em></a> R package and the vignettes for more information:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dataone)
<span class="kw">vignette</span>(<span class="st">&quot;download-data&quot;</span>, <span class="dt">package=</span><span class="st">&quot;dataone&quot;</span>)
<span class="kw">vignette</span>(<span class="st">&quot;upload-data&quot;</span>, <span class="dt">package=</span><span class="st">&quot;dataone&quot;</span>)</code></pre></div>
</div>
<div id="create-a-collection-of-objects" class="section level2">
<h2>Create a Collection of Objects</h2>
<p>A DataPackage is a container for a set of DataObjects. DataObject is a class that is a proxy for data of any type, including traditional data like CSV, tabular data, and spatial rasters, but also for non-traditional objects like derived data, figures, and scripts in R and Python. A collection of related DataObjects can be placed in a DataPackage and actions can be performed on it, such as serializing the entire collection of objects into a package file, or uploading all package member objects to a data repository.</p>
<p>This example creates a DataPackage with one DataObject containing metadata and two others containing science data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">metadataFile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/sample-eml.xml&quot;</span>, <span class="dt">package=</span><span class="st">&quot;datapack&quot;</span>)
metadataId &lt;-<span class="st"> &quot;metadataId&quot;</span>
metadataObj &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;DataObject&quot;</span>, <span class="dt">id=</span>metadataId, <span class="dt">format=</span><span class="st">&quot;eml://ecoinformatics.org/eml-2.1.0&quot;</span>, <span class="dt">file=</span>metadataFile)

csvfile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/sample-data.csv&quot;</span>, <span class="dt">package=</span><span class="st">&quot;datapack&quot;</span>)
sciId &lt;-<span class="st"> &quot;sciId1&quot;</span>
sciObj &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;DataObject&quot;</span>, <span class="dt">id=</span>sciId, <span class="dt">format=</span><span class="st">&quot;text/csv&quot;</span>, <span class="dt">filename=</span>csvfile)

outFile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/sample-data-filtered.csv&quot;</span>, <span class="dt">package=</span><span class="st">&quot;datapack&quot;</span>)
sciId2 &lt;-<span class="st"> &quot;sciId2&quot;</span>
sciObj2 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;DataObject&quot;</span>, <span class="dt">id=</span>sciId2, <span class="dt">filename=</span>outFile, <span class="dt">format=</span><span class="st">&quot;text/csv&quot;</span>)</code></pre></div>
<p>The identifier values used in this example are simple and easily recognizable for demonstration purposes. A more standard unique identifier can be created with the <code>uuid::UUIDgenerate()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myid &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;urn:uuid:&quot;</span>, <span class="kw">UUIDgenerate</span>(), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
myid</code></pre></div>
<pre><code>## [1] &quot;urn:uuid:cc2f78f3-d420-47c5-9e70-83d4f84f7163&quot;</code></pre>
<p>Next a DataPackage is created and the DataObjects are added to it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dp &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;DataPackage&quot;</span>)
dp &lt;-<span class="st"> </span><span class="kw">addData</span>(dp, <span class="dt">do =</span> metadataObj)</code></pre></div>
<pre><code>## Warning: 'addData' is deprecated.
## Use 'addMember' instead.
## See help(&quot;Deprecated&quot;) and help(&quot;datapack-deprecated&quot;).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dp &lt;-<span class="st"> </span><span class="kw">addData</span>(dp, <span class="dt">do =</span> sciObj)</code></pre></div>
<pre><code>## Warning: 'addData' is deprecated.
## Use 'addMember' instead.
## See help(&quot;Deprecated&quot;) and help(&quot;datapack-deprecated&quot;).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The second object will be added in the next section </span></code></pre></div>
<p>Information can also be extracted from the DataPackage. To show the identifiers of the DataObjects that are in the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getIdentifiers</span>(dp)</code></pre></div>
<pre><code>## [1] &quot;metadataId&quot; &quot;sciId1&quot;</code></pre>
<p>To show the number of DataObjects in the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getSize</span>(dp)</code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>To extract the data in a DataObject as raw data, ask for the data using the identifier of the DataObject:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sciObjRaw &lt;-<span class="st"> </span><span class="kw">getData</span>(dp, sciId)</code></pre></div>
<p>To get access to the full instance of the DataObject class representing a data object, use the <code>datapack::getMember</code> function and pass in the identifier of the desired object, which will return an instance of hte DataObject class:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mySciObj &lt;-<span class="st"> </span><span class="kw">getMember</span>(dp, sciId)</code></pre></div>
</div>
<div id="relationships-between-dataobjects" class="section level2">
<h2>Relationships Between DataObjects</h2>
<p>The relationships between DataObjects in a DataPackage can be recorded in the DataPackage. For example, a typical relationship is that a DataObject containing a metadata document in a domain specific format such as Ecological Metadata Language (EML) or ISO19139 geospatial metadata can describe, or document, DataObjects containing associated science data. Adding relationship information about data package members may assist a consumer of the package in better understanding the contents of the package and how to make use of the package.</p>
<p>While the DataPackage can record any type of relationships that are important to a community, we have provided functions to establish common relationships that are needed to understand scientific data in the DataONE federation. These include the following typical provenance properties:</p>
<ul>
<li><code>cito:documents</code>: for establishing that a metadata document provides descriptive information about one or more associated data objects</li>
<li><code>prov:wasDerivedFrom</code>: for asserting that a derived data object was created using data from one or more source data objects</li>
<li><code>prov:used</code>: for asserting that when a program (such as an R script) was executed that it used one or more source data objects as inputs</li>
<li><code>prov:wasGeneratedBy</code>: for asserting that when a program (such as an R script) was executed that it generated one or more derived data objects as outputs</li>
</ul>
<div id="linking-a-metadata-file-with-one-or-more-data-files-using-citodocuments" class="section level3">
<h3>Linking a metadata file with one or more data files using cito:documents</h3>
<p>The fastest way to add the <code>cito:documents</code> relationship is to include the metadata object when a science data object is added to the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dp &lt;-<span class="st"> </span><span class="kw">addData</span>(dp, <span class="dt">do =</span> sciObj2, <span class="dt">mo =</span> metadataObj)</code></pre></div>
<pre><code>## Warning: 'addData' is deprecated.
## Use 'addMember' instead.
## See help(&quot;Deprecated&quot;) and help(&quot;datapack-deprecated&quot;).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getRelationships</span>(dp, <span class="dt">condense=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##                 subject           predicate                object
## 2 sample-da...tered.csv cito:isDocumentedBy        sample-eml.xml
## 1        sample-eml.xml      cito:documents sample-da...tered.csv</code></pre>
<p>In that example, the <code>sciObj2</code> DataObject is added to the package using the <code>addData</code> call, and the metadata object <code>metadataObj</code> is passed in to the function as well. This tells the DataPackage that <code>metadataId cito:documents sciId2</code>. The <code>cito:documents</code> relationship is defined by the <a href="http://vocab.ox.ac.uk/index">Citation Typing Ontology</a> (CITO)).</p>
</div>
</div>
<div id="asserting-data-provenance-relationships-between-objects" class="section level2">
<h2>Asserting data provenance relationships between objects</h2>
<p>Relationships that describe the processing history of package members can be added. For example, a program that performs a modeling calculation might read one or more source data files as inputs, perform a calculation based on the data read, and then write a data or graphics file characterizing the results of the model run.</p>
<p>The <code>datapack</code> package uses the <a href="https://purl.dataone.org/provone-v1-dev">ProvONE</a> data model to represent provenance relationships.</p>
<p>The following example demonstrates how to insert provenance relationships into a DataPackage for the R program <code>logit-regression.R</code> that reads the source data file <code>binary.csv</code> and generates the derived image file <code>gre-predicted.png</code>. Using the example DataPackage for which DataObjects for the program input and output have already been added, we create a DataObject for the program, and call <code>describeWorkflow</code> to add the necessary provenance relationships:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dp &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;DataPackage&quot;</span>)

<span class="co"># This DataObject contains the program script that was executed</span>
progObj &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;DataObject&quot;</span>, <span class="dt">format=</span><span class="st">&quot;application/R&quot;</span>, 
           <span class="dt">filename=</span><span class="kw">system.file</span>(<span class="st">&quot;extdata/pkg-example/logit-regression-example.R&quot;</span>, <span class="dt">package=</span><span class="st">&quot;datapack&quot;</span>))
dp &lt;-<span class="st"> </span><span class="kw">addData</span>(dp, progObj)</code></pre></div>
<pre><code>## Warning: 'addData' is deprecated.
## Use 'addMember' instead.
## See help(&quot;Deprecated&quot;) and help(&quot;datapack-deprecated&quot;).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">doIn &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;DataObject&quot;</span>, <span class="dt">format=</span><span class="st">&quot;text/csv&quot;</span>, 
             <span class="dt">filename=</span><span class="kw">system.file</span>(<span class="st">&quot;./extdata/pkg-example/binary.csv&quot;</span>, <span class="dt">package=</span><span class="st">&quot;datapack&quot;</span>))
dp &lt;-<span class="st"> </span><span class="kw">addData</span>(dp, doIn)</code></pre></div>
<pre><code>## Warning: 'addData' is deprecated.
## Use 'addMember' instead.
## See help(&quot;Deprecated&quot;) and help(&quot;datapack-deprecated&quot;).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">doOut &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;DataObject&quot;</span>, <span class="dt">format=</span><span class="st">&quot;image/png&quot;</span>, 
             <span class="dt">filename=</span><span class="kw">system.file</span>(<span class="st">&quot;./extdata/pkg-example/gre-predicted.png&quot;</span>, <span class="dt">package=</span><span class="st">&quot;datapack&quot;</span>))
dp &lt;-<span class="st"> </span><span class="kw">addData</span>(dp, doOut)</code></pre></div>
<pre><code>## Warning: 'addData' is deprecated.
## Use 'addMember' instead.
## See help(&quot;Deprecated&quot;) and help(&quot;datapack-deprecated&quot;).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The arguments &quot;sources&quot; and &quot;derivations&quot; can also contain lists of &quot;DataObjects&quot;</span>
dp &lt;-<span class="st"> </span><span class="kw">describeWorkflow</span>(dp, <span class="dt">sources=</span>doIn, <span class="dt">program=</span>progObj, <span class="dt">derivations=</span>doOut)
rels &lt;-<span class="st"> </span><span class="kw">getRelationships</span>(dp, <span class="dt">condense=</span><span class="ot">TRUE</span>)
rels[<span class="kw">grepl</span>(<span class="st">&quot;prov:&quot;</span>, rels$predicate),]</code></pre></div>
<pre><code>##                  subject             predicate                object
## 5  _01723eff...cf10d7a86          prov:hadPlan logit-reg...example.R
## 11     gre-predicted.png   prov:wasDerivedFrom            binary.csv
## 10     gre-predicted.png   prov:wasGeneratedBy urn:uuid:...0844d89ac
## 3  urn:uuid:...0844d89ac prov:qual...sociation _01723eff...cf10d7a86
## 9  urn:uuid:...0844d89ac             prov:used            binary.csv</code></pre>
<p>Note that in this example, the R script had previously been run and generated the image file before <code>describeWorkflow()</code> was called. The <code>sources</code> and <code>derivations</code> arguments for <code>describeWorkflow()</code> can be lists of either DataObjects or the identifiers of DataObjects.</p>
<div id="inserting-other-arbitrary-relationships" class="section level3">
<h3>Inserting other (arbitrary) relationships</h3>
<p>Other types of relationships between DataPackage member DataObjects can be recorded with the <code>insertRelationship</code> method. The main requirement is that each relationship to be described needs to have a unique URI that is drawn from a controlled vocabulary like the Citation Typing Ontology described above. The <code>cito:documents</code> relationship is the default used by <code>insertRelationship</code>, so the relationship type doesn’t need to be specified in this case. For example, with the example DataPackage created above, we can add the <code>cito:documents</code> relationship:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dp &lt;-<span class="st"> </span><span class="kw">insertRelationship</span>(dp, <span class="dt">subjectID=</span>metadataId, <span class="dt">objectIDs=</span>sciId)
relations &lt;-<span class="st"> </span><span class="kw">getRelationships</span>(dp, <span class="dt">condense=</span><span class="ot">TRUE</span>)
relations[<span class="kw">grepl</span>(<span class="st">&quot;cito:documents&quot;</span>, relations$predicate),]</code></pre></div>
<pre><code>##       subject      predicate object
## 12 metadataId cito:documents sciId1</code></pre>
<p>Relationships can be fully specified using the URI of the concept, as shown in the following statement that adds a provenence relationship between two objects in the example package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dp &lt;-<span class="st"> </span><span class="kw">insertRelationship</span>(dp, <span class="dt">subjectID=</span>sciId2, <span class="dt">objectIDs=</span>sciId,
                   <span class="dt">predicate=</span><span class="st">&quot;http://www.w3.org/ns/prov#wasDerivedFrom&quot;</span>)
relations &lt;-<span class="st"> </span><span class="kw">getRelationships</span>(dp, <span class="dt">condense=</span><span class="ot">TRUE</span>)
relations[<span class="kw">grepl</span>(<span class="st">&quot;prov:wasDerivedFrom&quot;</span>, relations$predicate),]</code></pre></div>
<p>The relationships contained in a DataPackage conform to the <a href="https://www.w3.org/RDF/">Resource Description Framework</a> (RDF), which is a <a href="https://www.w3.org/">World Wide Web Consortium</a> standard for describing web accessible resources.</p>
</div>
</div>
<div id="describing-the-contents-of-a-datapackage" class="section level2">
<h2>Describing The Contents of a DataPackage</h2>
<p>In order to transport a DataPackage, for example to a data repository, a description of the contents of the DataPackage is created so that the consumer of the DataPackage can determine how to extract and process the contents.</p>
<p>A DataPackage can produce a standard description of its members and relationships which conforms to the Open Archives Initiative <a href="https://www.openarchives.org/ore/">Object Reuse and Exchange</a> (OAI-ORE) specification, which is a widely used standard to describe aggregations of web accessible resources. This OAI-ORE description is referred to as a <em>resource map</em>.</p>
<p>The <code>serializePackage</code> method will create Resource Description Framework serialization of a resource map, written to a file in this case, that conforms to the OAI-ORE specification.</p>
<p>To create a resource map for the example DataPackage:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tf &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
packageId &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;urn:uuid:&quot;</span>, <span class="kw">UUIDgenerate</span>(), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
<span class="kw">serializePackage</span>(dp, <span class="dt">file=</span>tf, <span class="dt">id=</span>packageId)</code></pre></div>
<p>This example writes to a tempfile using the default serialization format of “rdfxml”. Also the URLs for each package member are prepended with the default value of the DataONE resolve service, which would be the URL that could be used to access this data object if the package is uploaded to a DataONE member node.</p>
<p>A different value to be prepended to each identifier can be specified with the <code>resoveURI</code> argument. To specify that no value be prepended to the identifier URLs, specify a zero-length character:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tf &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
packageId &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;urn:uuid:&quot;</span>, <span class="kw">UUIDgenerate</span>(), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
<span class="kw">serializePackage</span>(dp, <span class="dt">file=</span>tf, <span class="dt">id=</span>packageId, <span class="dt">resolveURI=</span><span class="st">&quot;&quot;</span>)</code></pre></div>
<p>It is also possible to create a JSON serialization, if desired:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tf &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
packageId &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;urn:uuid:&quot;</span>, <span class="kw">UUIDgenerate</span>(), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
<span class="kw">serializePackage</span>(dp, <span class="dt">file=</span>tf, <span class="dt">id=</span>packageId, <span class="dt">syntaxName=</span><span class="st">&quot;json&quot;</span>, <span class="dt">mimeType=</span><span class="st">&quot;application/json&quot;</span>, <span class="dt">resolveURI=</span><span class="st">&quot;&quot;</span>)</code></pre></div>
</div>
<div id="saving-datapackage-contents-to-a-file" class="section level2">
<h2>Saving DataPackage Contents to a File</h2>
<p>The contents of a DataPackage can be saved to a file using the <code>serializeToBagIt</code> method. This creates a <em>BagIt</em> file, which is a hierarchical file packaging format.</p>
<p>The created BagIt file contains the data from the DataPackage members as well as an OAI-ORE resource map that is automatically created by <code>serializeToBagIt</code>.</p>
<p>The following R command shows how to create the BagIt file for the example DataPackage:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bagitFilename &lt;-<span class="st"> </span><span class="kw">serializeToBagIt</span>(dp)</code></pre></div>
<p>The variable <code>bagitFilename</code> contains the file path to the temporary BagIt file. This file should be copied to another location before quiting or restarting R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">file.copy</span>(bagitFilename, <span class="st">&quot;~/myPackageFile.zip&quot;</span>)</code></pre></div>
<p>This serialized BagIt version of the file is an excellent way to transport all of the files and metadata of a DataPackage to a data repository or a collaborator.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
